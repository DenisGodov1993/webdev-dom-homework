<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <div class="container">
      <ul class="comments" id="comment">
        <!-- <li class="comment">
          <div class="comment-header">
            <div>Глеб Фокин</div>
            <div>12.02.22 12:18</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Это будет первый комментарий на этой странице
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">3</span>
              <button class="like-button"></button>
            </div>
          </div>
        </li>
        <li class="comment">
          <div class="comment-header">
            <div>Варвара Н.</div>
            <div>13.02.22 19:22</div>
          </div>
          <div class="comment-body">
            <div class="comment-text">
              Мне нравится как оформлена эта страница! ❤
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">75</span>
              <button class="like-button -active-like"></button>
            </div>
          </div>
        </li> -->
      </ul>
      <div class="add-form">
        <input type="text" class="add-form-name" placeholder="Введите ваше имя" id="name"/>
        <textarea type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" 
        rows="4" id="textarea"></textarea>
        <div class="add-form-row">
          <button class="add-form-button" id="write">Написать</button>
        </div>
      </div>
    </div>
    <script>
      const commentEl = document.getElementById('comment');
      const nameEl = document.getElementById('name');
      const textareaEl = document.getElementById('textarea');
      const writeEl = document.getElementById('write');

      const comments = [ //Добавьте в массив ключи, в которых будет храниться состояние лайка и их количество.
        {
          name: "Глеб Фокин",
          date: "12.02.22 12:18",
          text: "Это будет первый комментарий на этой странице",
          likes: 3,
          liked: false
        },
        {
          name: "Варвара Н.",
          date: "13.02.22 19:22",
          text: "Мне нравится как оформлена эта страница! ❤",
          likes: 75,
          liked: true
        }
      ];

      function renderComments() {
        commentEl.innerHTML = ''; // очистили html код где id = comment
        comments.forEach((comment, index) => {
          const likeClass = comment.liked ? '-active-like' : ''; // Класс для активного лайка
          const newCommentHtml = `
          <li class="comment">
            <div class="comment-header">
              <div>${comment.name}</div>
              <div>${comment.date}</div>
            </div>
            <div class="comment-body">
              <div class="comment-text">${comment.text}</div>
            </div>
            <div class="comment-footer">
              <div class="likes">
                <span class="likes-counter">${comment.likes}</span>
                <button class="like-button ${likeClass}" data-index="${index}"></button> 
              </div>
            </div>
          </li>`;//В разметке укажите необходимый класс для иконки лайка в зависимости от значения ключа в массиве.

          commentEl.innerHTML += newCommentHtml; // Добавление нового комментария в контейнер

        });

        attachLikeHandlers(); // Привязка обработчиков событий к кнопкам лайков
      }

      function handleLikeClick(index) { //В функции клика на лайк нужно менять значения ключей в массиве и после этого заново выполнять рендер всех комментариев.
        comments[index].liked = !comments[index].liked; // переключаем состояние лайка
        comments[index].likes += comments[index].liked ? 1 : -1; // обновление количества лайков, если пользователь поставил лайк под комментарием
        renderComments(); // отображает изменения на странице
      }

      function attachLikeHandlers() {
        const likeButtons = commentEl.querySelectorAll('.like-button'); // все кнопки лайков 
        likeButtons.forEach((button) => {
          button.addEventListener('click', (event) => {
            const index = button.getAttribute('data-index'); // индекс из атрибута data-index 
            handleLikeClick(index); // Обрабатываем клик по лайку
          });
        });
      }

      writeEl.addEventListener('click', () => {
        if (!nameEl.value.trim() || !textareaEl.value.trim()) { // Проверка заполненности полей ввода
          alert('Ошибка! Добавить комментарий возможно только при заполнении всех полей ввода!');
          return;
        }

        const currentDate = new Date(); // отображение текущей даты в необходимом формате
        const options = { year: '2-digit', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' };
        const dateString = currentDate.toLocaleString('ru-RU', options).replace(',', '');

        comments.push({
          name: nameEl.value.trim(),
          date: dateString,
          text: textareaEl.value.trim(),
          likes: 0,
          liked: false
        });

        // Очистка полей ввода
        nameEl.value = "";
        textareaEl.value = "";
          
        renderComments(); // Обновляем отображение комментариев на странице
      });

      renderComments(); // Первоначальное отображение комментариев при загрузке страницы
  
    </script>
  </body>
</html>
